---
title: "phylogrid-vignette"
author: "Gabriela Alves-Ferreira"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{phylogrid-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

The goal of *phylogrid* is to calculate phylogenetic indices (such as phylogenetic diversity (PD. Faith 1992), phylogenetic endemism (PE. Rosauer et al. 2009) and weighted endemism (WE)) for presence-absence rasters and return a raster object as an output.

## Steps to calculte PD, PE and WE using *phylogrid*

### First, load phylogenetic and spatial data

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(phylogrid)
library(terra)
library(ape)
```

```{r}
ras <- terra::rast(system.file("inst/extdata", "rast.presab.tif", package="phylogrid"))
tree <- ape::read.tree(system.file("inst/extdata", "tree.nex", package="phylogrid"))
```
### Visualize

```{r}
plot(ras)
```

```{r}
plot(tree)
```

### Now, let's prepare the dataset! The stack will be sorted according to the tree order and the branch lengths will be extracted for each species.

```{r}
dataprep <- phylogrid::phylo.pres(pres.stack = ras, tree = tree)
```

### After that, we will calculate the inverse of the range size and the inverse of the range size multiplied by the length of the branches. If you want to save these rasters directly to your computer, provide a path in the filename argument.

```{r}
range <- phylogrid::inv.range(pres.reord = dataprep$pres.reord, branch.length = dataprep$branch.length, filename = NULL)
```

### Now, we are already able to calculate PD, PE and WE!!

```{r}
pg <- phylogrid::geo.phylo(pres.reord = dataprep$pres.reord, area.inv = range$inv.R,
                          area.tips = range$LR, range$LR, branch.length = dataprep$branch.length)
plot(pg)
```
